<!DOCTYPE html>
<html lang="en">

<head>
    <!-- bootstrap -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Bubblegum Sans' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <title>Home</title>

    <!-- css -->
    <style>
        .sidenav {
            height: 100%;
            width: 200px;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #4369CA;
            overflow-x: hidden;
            padding-top: 20px;
        }

        .sidenav a {
            padding: 6px 6px 6px 32px;
            text-decoration: none;
            font-size: 25px;
            color: white;
            display: block;
        }

        .sidenav a:hover {
            color: white;
            background-color: darkblue;
        }

        .sidenav a.active {
            background-color: rgb(159, 203, 238);
            color: black;
        }

        .main {
            margin-left: 200px;
            /* Same as the width of the sidenav */
        }

        .modal {
            position: center;
            left: 30%;
            top: 30%;
            width: 40%;
            display:none;
        }


        .modal-content {
            background-color: #6F8FE2;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }


        /* The Close Button */
        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .dropbtn {
            margin-left: 5%;
            background-color: #4369CA;
            color: white;
            padding: 16px;
            font-size: 25px;
            border: none;
            cursor: pointer;
        }

        .dropdown {
            margin-left: 5%;
            width: 100%;
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 160px;
            overflow: auto;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            margin-left: 15px;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown a:hover {
            background-color: #ddd;
        }

        .show {
            display: block;
        }

        .hidden-button {
            visibility: hidden;
        }

        .stretched-link {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .menu-icon {
            z-index: 2;
        }

        .card {
            padding-top: 30px;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-button {
            position: absolute;
            top: 30%; 
            right: 21rem;
            transform: translateY(-50%);
            color: black;
            pointer-events: none;
            margin-left: -2rem;
        }


        .searchbox {
            border-radius: 15px;
            width:350%;
            height: 35px;
            margin-right: 0.5rem;
        } 
    </style>

</head>

<body>
    <!-- logo -->
    <img style="margin-left: 79%; height: 150px; width: 150px;" src="logo.png"> 
    <!-- name of website under beside logo -->
    <h4 style="margin-left: 87%; margin-top: -6%;"> NoteGenius</h4>
    <!-- name to signify page user is on -->
    <h1 style="margin-left:17%; margin-top: 1%;">My Notes</h1> 
    
    <div class="search-container" style="width: 70%; margin-left: 25%; ;">
        <div class="search-wrapper">
            <!-- search to allow user to search for all the notes created by user. -->
            <form action="search" method="get">
                <i class="fa fa-search search-button" style="margin-left: 2rem;"></i>
                <input type="text" placeholder="Search.." name="note_title" class="searchbox">
                <button style="border: white; color: white;" type="submit"></button>
            </form>
            <!-- button to allow user to cancel search, remove all the notes based on search and show all the notes retrieved -->
            <form action="/getAllNotes" method="get">
                <div class="search-wrapper">
                    <button style="border-radius: 15px; width: auto; white-space: nowrap; background-color: white; color: black; margin-left: 370%; margin-top: -14%; height: 100%;">
                        Clear Searches <i class="fas fa-times-circle" style="color: red; font-size: 1.5rem; margin-top: 0.5%;"></i>
                    </button>
                </div>
            </form>
        </div>
        
        
    </div>
    

    <!-- <div class="search-container" style="width: 100%; margin-left: 30%; margin-top: 2%; display: flex; align-items: center;">
        <form action="search" method="get">
            <div class="search-wrapper" style="position: relative;">
                <i class="fa fa-search search-button" style="margin-left: 2rem;"></i>
                <input type="text" placeholder="Search.." name="note_title" class="searchbox">
            </div>
            <button style="border: white; color: white; background-color: transparent;" type="submit"></button>
        </form>
        <button type="submit" style="border: 0px; background-color: transparent; margin-top: -1%;">
            <i class="fas fa-times-circle" style="color: red; font-size: 1.5rem;"></i>
        </button>
    </div> -->
    
    

    <!-- side nav -->
    <div id="mySidenav" class="sidenav">
        <h1>
        <!-- show user's name, onclick direct user to user profile page -->
        <% users.forEach(function(user){ %>
            <a href="/userprofile"><%= user.user_name %></a>
        <% }) %>
        </h1>
        <br>
        <br>
        <br>
        <br>
        <br>
        <!-- home page, show user they are on home page -->
        <a class="active" style="margin-left: -2%;" href="/getAllNotes">home</a>
        <!-- bookmarks page -->
        <a href="/bookmarkNote" style="margin-left: -2%;">bookmarks</a>
        <!-- folder droplist to show user the folders available and allow user to see what notes is in which folder -->
        <button onclick="myFunction()" class="dropbtn">folders</button>
        <div id="myDropdown" class="dropdown-content">
            <a href="/getAllNotes">all</a>
            <% folders.forEach(function(folder){ %>
                <a href="/getNotesFromFolder?folder_id=<%= folder.folder_id %>">
                    <%= folder.folder_name %>
                </a>
            <% }) %>
        </div>
        <!-- logout, destroy session storage -->
        <a href="/logout" style="margin-left: -3%;">log out</a>
    </div> 

    <!-- create notes -->
    <form action="/notes" method="get" style="margin-left: 86%; color: #4369CA">
        <i class="fas fa-plus"></i> 
        <button type="submit" style="border: #f1f1f1; background-color: white; color: #4369CA">create new note</button>
    </form>

    <!-- create folder -->
    <button id="modelBtn" style="margin-left: 86%; color: #4369CA; border: #f1f1f1; background-color: white; color: 4369CA">
        <i class="fas fa-plus" style="margin-left: -5px; margin-right: 5px;" ></i>   create new folder
    </button>

    <!-- folder modal -->
    <div class="folder-modal" style="margin-left:25%; width: 60%;">
        <div class="modal-content">
            <!-- modal header stores the cross icon to close modal, and modal title -->
            <div class="modal-header"> 
                <span class="close">&times;</span>
                <h1 class="modal-title" style="font-size: 20px; margin-right: 35%;">Create New Folder</h1> 
            </div>
            <!-- modal body stores the form to create folder -->
            <div class="modal-body"> 
                <form action="/createFolder" method="post" style="margin-left: 0%;">
                    <!-- folder name -->
                    <input type="text" id="folder_name" name="folder_name" placeholder="Enter folder name here..."
                        style="margin-left:1%; width: 100%; border-radius: 5px; height: auto; font-size: 20px; text-align: left;">
                    </input>
                    <br>
                    <br>
                    <!-- submit button -->
                    <center><button type="submit" style="width: 90%; height: 30px; border-radius: 5px; margin-left:3%; margin-top:1%; background-color: white; border: 2px solid blue;">create folder</button></center>
                </form>
            </div>
        </div>
    </div> 
  


    <!-- loop through the notes array to pull out the corresponding data -->
    <div class="row" style="margin-left:15%; margin-top: 3%;">
        <% notes.forEach(function(note){ %>
            <div class="col mb-4 padding-top: 3%">
                <div class="card" style="width: 20rem;">
                    <!-- header stores the last modifed date, menu icon and note title -->
                    <div class="card-header d-flex justify-content-between align-items-center" style="background-color: white;">
                        <div>
                            <%= new Date(note.note_mdatetime).toLocaleString() %>
                        </div>
                        <div class="menu-icon">
                            <i class="fas fa-ellipsis-h"></i>
                        </div>
                    </div>
                            <div style="margin-top: 2%;">
                            <center>
                                <h3>
                                <%= note.note_title %>
                            </h3>
                                
                            </center>
                        </h3>
                    </div>
                    
                    <!-- card body stores note content -->
                    <h5 class="card-body">
                        <br>
                        <center>
                            <%= note.note_content %>
                        </center>
                        <br>
                    </h5>

                    <!-- card footer stores the created datetime -->
                    <div class="card-footer" style="background-color: white;">
                        <center>
                            <text>created on :</text>
                            <%= new Date(note.note_cdatetime).toLocaleString() %>
                        </center>
                       <!-- stretched link to direct user to notes page -->
                        <a class="stretched-link" href="/getIndivNote?note_id=<%= note.note_id%>"></a>
                    </div>

                    
                <!-- modal gets called when menu icon is clicked -->
                    <div class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <span class="close">&times;</span>
                                <h1 class="modal-title" style="font-size: 20px; margin-right: 30%;">Note Settings</h1> 
                            </div>
                            <!-- option to rename note, delete note and bookmark note -->
                            <div class="modal-body">
                                <form action="updateNoteSettings" method="get">
                                    <input type="hidden" name="note_id" value="<%= note.note_id %>">
                                    <button type="submit" style="width: 80%; height: 30px; border-radius: 5px; margin-left:10%; background-color: white; border: 2px solid blue;" >rename note</button>
                                </form>
    
                                <form action="deleteNote" method="post">
                                    <input type="hidden" name="note_id" value="<%= note.note_id %>">
                                    <button type="submit" onclick="checker()" style="width: 80%; height: 30px; border-radius: 5px; margin-left:10%; margin-top:1%; background-color: white; border: 2px solid blue;">delete</button>
                                </form>

                                <form action="bookmarkNote" method="post">
                                    <input type="hidden" name="note_id" value="<%= note.note_id %>">
                                    <button type="submit" style="width: 80%; height: 30px; border-radius: 5px; margin-left:10%; background-color: white; border: 2px solid blue;" >bookmark note</button>
                                </form>

                                <form action="summary" method="get">
                                    <button style="width: 80%; height: 30px; border-radius: 5px; margin-left:10%; background-color: white; border: 2px solid blue;"> summary </button>
                                </form>
                                <form action="rv" method="get">
                                    <button style="width: 80%; height: 30px; border-radius: 5px; margin-left:10%; background-color: white; border: 2px solid blue;"> revision question </button>
                                </form>
                                
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        <% }) %>
    </div>


    <script>
        // menu icon modal
        // declare modals and menu icon buttons
        var modals = document.querySelectorAll(".modal");
        var btn = document.querySelectorAll(".menu-icon");

        // onclick show modal
        btn.forEach(function (button, index) {
            button.addEventListener("click", function (event) {
                modals[index].style.display = "block";
            })
        });

        // onclick close modal
        var spans = document.querySelectorAll(".close");
        spans.forEach(function (span) {
            span.addEventListener("click", function () {
                modals.forEach(function (modal) {
                    modal.style.display = "none";
                });
            });
        });

        // close modal regardless where user click
        window.onclick = function (event) {
            if (event.target.classList.contains("modal")) {
                modals.forEach(function (modal) {
                    modal.style.display = "none";
                });
            }
            if (event.target === modals) {
                modals.style.display = "none";
            }
        };

        // folder modal
        // declare the modal button and content
        var folderModalButton = document.getElementById("modelBtn");
        var folderModalContent = document.querySelector(".folder-modal");

        // onclick, open folder modal
        folderModalButton.addEventListener("click", function (event) {
            folderModalContent.style.display = "block";
        });

        

        // declare close icon in folder modal
        var folderModalClose = folderModalContent.querySelector(".close");

        // onclick, close folder modal
        folderModalClose.addEventListener("click", function (event) {
            event.stopPropagation();
            folderModalContent.style.display = "none";
        });

        // When the user clicks anywhere outside the modal, close it
        window.addEventListener("click", function (event) {
            if (event.target === folderModalContent) {
                folderModalContent.style.display = "none";
            }

            modals.forEach(function (modal) {
                if (event.target === modal&& event.target !== folderModalContent) {
                    modal.style.display = "none";
                }
            });
        });

        window.addEventListener("load", function () {
            folderModalContent.style.display = "none";
        });


        // droplist
        function myFunction() {
            document.getElementById("myDropdown").classList.toggle("show");
        }

        var dropdownContent = document.getElementById("myDropdown");
        if (!dropdownContent.contains(event.target)) {
            // If the clicked target is not inside the folder dropdown, close it
            dropdownContent.classList.remove("show");
        }
        
        // confirmation alert, get user to confirm the deletion of note
        function checker() {
            var result = confirm('Are you sure you want to delete this note?');
            if (result == false) {
                event.preventDefault();
            }
        }
    </script>
</body>

</html>